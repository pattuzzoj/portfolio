---
import i18n from "@/shared/i18n";
import LanguagePicker from "@/shared/components/language-picker";
import MenuMobile from "./menuMobile";
import Form from "@/features/blog/components/form/form.tsx";
import SwitchTheme from "@/shared/components/switch-theme";

const { t } = i18n;
---

<header
  class="sticky top-0 z-10 flex items-center justify-between lg:grid lg:grid-cols-3 lg:gap-8 py-2 px-8 border-b border-b-outline bg-fill-base"
>
  <a
    class="w-fit text-2xl md:text-2xl font-semibold! rounded-xl p-2 text-ink-accent bg-fill-accent/10"
    href={t("blog:header.logo.href")}>{t("blog:header.logo.label")}</a
  >
  <div class="hidden md:block">
    <Form client:load />
  </div>
  <div class="hidden md:flex justify-end items-center gap-4">
    <div class="flex items-center gap-2 rounded-xl p-1 bg-fill-surface-soft">
      <LanguagePicker client:load />
      <SwitchTheme client:load />
    </div>
    <span class="text-ink-muted">|</span>
    <a
      class="bg-fill-accent hover:bg-fill-accent-hover text-ink-on-accent px-4 py-2 rounded-xl"
      href={t("blog:header.portfolio.href")}>{t("blog:header.portfolio.label")}</a
    >
  </div>
  <div class="md:hidden">
    <MenuMobile client:load />
  </div>
</header>

<script>
  const menuLinks = document.querySelectorAll("[data-header-menu-id]");

  const observer = new IntersectionObserver(
    (entries: IntersectionObserverEntry[]) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const id = entry.target.id;

          menuLinks.forEach((link) => {
            if (link.getAttribute("data-header-menu-id") === id) {
              link.setAttribute("data-header-menu-active", "true");
            } else {
              link.setAttribute("data-header-menu-active", "false");
            }
          });
        }
      });
    },
    {
      rootMargin: "-50% 0px -50% 0px",
    },
  );

  const sectionsID = ["home", "about", "technologies", "projects", "contact"];
  sectionsID.forEach((sectionID) => {
    const element = document.getElementById(sectionID) as Element;

    if (!element) return;

    observer.observe(element);
  });
</script>
