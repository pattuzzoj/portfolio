---
export const prerender = false;

import { getCollection } from "astro:content";
import { DEFAULT_LOCALE } from "@/shared/i18n";
import i18n from "@/shared/i18n";
import BlogLayout from "@/features/blog/layouts/blog-layout.astro";
import BlogPage from "@/features/blog/views/pages/blog-page";
import { filterPostsByCategory, filterPostsBySearch, filterPostsByTags, filterPostsByTime } from "@/features/blog/utils/blog/filters";

// export async function getStaticPaths() {
//   return [
//     { params: { locale: "en" }},
//     { params: { locale: "pt" }}
//   ];
// }

const { locale = DEFAULT_LOCALE } = Astro.params;
const { searchParams } = Astro.url;
const search = searchParams.get("search") ?? "";
const category = searchParams.get("category") ?? "all";
const tags = searchParams.get("tags")?.split(",") ?? [];
const time = searchParams.get("time") ?? "all";
let posts = await getCollection("blog", (post) => post.data.lang === locale);
posts = filterPostsByCategory(posts, category, locale as "pt" | "en");
posts = filterPostsByTags(posts, tags);
posts = filterPostsByTime(posts, time);
posts = filterPostsBySearch(posts, search);
const { t } = i18n;

---
<BlogLayout title={t("blog:meta.title")} description={t("blog:meta.description")} keywords={t("blog:meta.keywords")}>
  <BlogPage posts={posts} search={search} category={category} tags={tags} time={time} client:load />
</BlogLayout>
